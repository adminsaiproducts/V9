# CRM V9 Squad: AI チーム運営ガイド

## 🎯 概要

このガイドは、**CRM V9 Squad** の使い方を説明します。これは、PROJECT_MANIFEST.mdで定義された「自律的AIチーム」構造を、ワークフローベースで実現するシステムです。

Antigravityは真のマルチエージェント協調機能を持ちませんが、このシステムは**ロールベースのワークフロー**を提供し、タスクに応じてAIが異なる専門家として振る舞うことを可能にします。

---

## 👥 Squadメンバー

### 🧠 Planner (コンテキスト設計者)
**ワークフロー**: `.agent/workflows/planner.md`

**呼び出しタイミング**:
- 新機能の開始時
- 複雑な要件の分解時
- タスク実行戦略の最適化時

**呼び出し方法**:
```
Plannerとして、この要件を分解してください: [要件]
```

**例**:
```
Plannerとして、この要件を分解してください:
「ダッシュボードに顧客関係の可視化機能を追加する」
```

---

### 🔨 Backend-Dev (GAS/Firestore スペシャリスト)
**ワークフロー**: `.agent/workflows/backend-dev.md`

**呼び出しタイミング**:
- GASサーバーサイドロジック
- Firestoreデータベース操作
- 監査ログの実装
- Webpack バックエンド設定

**呼び出し方法**:
```
Backend-Devとして、これを実装してください: [要件]
```

**例**:
```
Backend-Devとして、これを実装してください:
「監査ログ付きで顧客関係を取得するFirestore関数を作成」
```

**重要な制約**:
- ✅ Windows/PowerShell構文のみ
- ✅ JS/CSSのBase64エンコード
- ✅ 全データ操作に監査ログ
- ✅ 論理削除のみ（物理削除禁止）

---

### 🎨 Frontend-Dev (React/MUI スペシャリスト)
**ワークフロー**: `.agent/workflows/frontend-dev.md`

**呼び出しタイミング**:
- Reactコンポーネント開発
- Material UI実装
- フロントエンドWebpack設定
- UX/UI改善

**呼び出し方法**:
```
Frontend-Devとして、これを実装してください: [要件]
```

**例**:
```
Frontend-Devとして、これを実装してください:
「MUIスタイリングを使ったD3.js関係図コンポーネントを作成」
```

**重要な制約**:
- ✅ Base64エンコード必須
- ✅ MUIコンポーネントのみ（素のHTML禁止）
- ✅ ゼロフリクションUX設計
- ✅ ダッシュボード読み込み1秒以内

---

### ⚖️ Auditor (厳格な審査官)
**ワークフロー**: `.agent/workflows/auditor.md`

**呼び出しタイミング**:
- コード実装後
- デプロイ前
- 品質保証チェック
- コンプライアンス検証

**呼び出し方法**:
```
Auditorとして、これを検証してください: [検証対象]
```

**例**:
```
Auditorとして、これを検証してください:
「顧客関係機能がデプロイ準備完了か」
```

**重要な要件**:
- ✅ ビジュアル検証（スクリーンショット必須）
- ✅ 監査ログ検証
- ✅ 完了定義（DOD）の強制
- ✅ 証拠なしの承認禁止

---

### 🎩 Director (ユーザー代理人)
**ワークフロー**: `.agent/workflows/director.md`

**呼び出しタイミング**:
- 最終デプロイ承認
- 本番リリース
- リスク評価
- ユーザーコミュニケーション

**呼び出し方法**:
```
Directorとして、これをデプロイしてください: [デプロイ対象]
```

**例**:
```
Directorとして、これをデプロイしてください:
「検証済みの顧客関係機能を本番環境へ」
```

**自動承認基準**:
- ✅ マニフェスト準拠
- ✅ Auditor承認済み
- ✅ 破壊的変更なし
- ✅ デプロイ枠OK

---

## 🔄 典型的なワークフロー

### 例: 新機能の追加

#### ステップ1: 計画
```
Plannerとして、この要件を分解してください:
「ドラッグ&ドロップ可能なカンバン式案件パイプラインを追加」
```

**期待される出力**:
- タスク分解
- コンポーネント識別
- リスク評価
- エージェント割り当て

---

#### ステップ2: バックエンド実装
```
Backend-Devとして、これを実装してください:
「監査ログ付きの案件パイプラインCRUD操作用Firestore関数」
```

**期待される出力**:
- GAS関数作成
- 監査ログ実装
- 論理削除の強制
- ビルド検証

---

#### ステップ3: フロントエンド実装
```
Frontend-Devとして、これを実装してください:
「react-beautiful-dndを使ったMUI製Reactカンバンコンポーネント」
```

**期待される出力**:
- Reactコンポーネント作成
- MUIスタイリング適用
- Base64エンコード設定
- ビルド検証

---

#### ステップ4: 品質保証
```
Auditorとして、これを検証してください:
「案件パイプライン機能が完成しデプロイ準備完了か」
```

**期待される出力**:
- コード監査完了
- ビジュアル検証スクリーンショット
- コンプライアンスチェック合格
- DOD基準達成

---

#### ステップ5: デプロイ
```
Directorとして、これをデプロイしてください:
「検証済みの案件パイプライン機能を本番環境へ」
```

**期待される出力**:
- デプロイ実行
- URL提供
- スクリーンショット取得
- Gitコミット作成

---

## 🎯 クイックコマンド

### 新機能の開始
```
/planner [機能説明]
```

### バックエンド作業
```
/backend-dev [バックエンドタスク]
```

### フロントエンド作業
```
/frontend-dev [フロントエンドタスク]
```

### 検証とデプロイ
```
Auditorとして最新の変更を検証し、承認されたらDirectorとしてデプロイしてください
```

---

## 📋 ロール切り替え構文

### 明示的なロール割り当て
```
[ロール]として、[アクション]してください:
[詳細な要件]
```

### マルチロールワークフロー
```
1. Plannerとして、これを分解してください: [要件]
2. Backend-Devとして、バックエンドタスクを実装してください
3. Frontend-Devとして、フロントエンドタスクを実装してください
4. Auditorとして、すべてを検証してください
5. Directorとして、デプロイしてください
```

### 自律モード
```
Squadワークフローを使って、この機能を自律的に完成させてください:
[機能説明]

完全なワークフローに従ってください: Planner → Backend-Dev → Frontend-Dev → Auditor → Director
```

---

## 🛡️ コンプライアンス強制

### 必須チェック（全デプロイ）

#### Backend-Devが検証すべき項目:
- [ ] Windows/PowerShell構文
- [ ] 監査ログ実装済み
- [ ] 論理削除使用
- [ ] ビルド出力 > 1KB

#### Frontend-Devが検証すべき項目:
- [ ] Base64エンコード設定済み
- [ ] MUIコンポーネント使用
- [ ] TypeScriptエラーなし
- [ ] ビルド出力 > 1KB

#### Auditorが検証すべき項目:
- [ ] ビジュアル検証スクリーンショット
- [ ] 全DOD基準達成
- [ ] コンプライアンスチェック合格
- [ ] 却下基準に該当なし

#### Directorが検証すべき項目:
- [ ] マニフェスト準拠
- [ ] Auditor承認済み
- [ ] デプロイ枠OK
- [ ] Gitコミット作成済み

---

## 📁 ファイル構造

```
V9/
├── .agent/
│   ├── workflows/
│   │   ├── planner.md          # タスク分解
│   │   ├── backend-dev.md      # GAS/Firestoreスペシャリスト
│   │   ├── frontend-dev.md     # React/MUIスペシャリスト
│   │   ├── auditor.md          # QA & 検証
│   │   └── director.md         # デプロイ & 承認
│   ├── deployment-log.md       # デプロイ履歴
│   └── deployments/            # 検証スクリーンショット
├── PROJECT_MANIFEST.md         # システム要件
├── SQUAD_GUIDE.md              # このファイル
└── QUICK_REFERENCE.md          # クイックリファレンス
```

---

## 🚀 はじめ方

### 1. マニフェストを読む
```
PROJECT_MANIFEST.mdを確認してシステム要件を理解する
```

### 2. ワークフローを選ぶ
- 新機能? → **Planner**から開始
- バックエンドタスク? → **Backend-Dev**を使用
- フロントエンドタスク? → **Frontend-Dev**を使用
- 検証? → **Auditor**を使用
- デプロイ? → **Director**を使用

### 3. ロールを呼び出す
```
[ロール]として、[アクション]してください: [要件]
```

### 4. ワークフローに従う
各ワークフローファイルには以下が含まれます:
- ロール定義
- 重要な制約
- ステップバイステップの手順
- チェックリスト
- 例

---

## 💡 効果的なSquad活用のヒント

### 1. 具体的に指示する
❌ 「フロントエンドを修正して」
✅ 「Frontend-Devとして、index.htmlのBase64デコードエラーを修正してください」

### 2. ワークフローを参照として使う
各ワークフローには以下が含まれます:
- ベストプラクティス
- 共通パターン
- チェックリスト
- 例

### 3. 複雑なタスクにはロールを連鎖させる
```
Plannerとして、この機能を分解してください: [機能]
次にBackend-Devとして、バックエンドタスクを実装してください
次にFrontend-Devとして、フロントエンドタスクを実装してください
次にAuditorとして、検証してください
最後にDirectorとして、デプロイしてください
```

### 4. プロトコルを信頼する
ワークフローはPROJECT_MANIFEST.mdの要件をエンコードしています:
- Windows/PowerShell制約
- Base64エンコード
- 監査ログ
- ビジュアル検証

---

## 🔧 トラブルシューティング

### 「どのロールを使えばいいか忘れた」
**解決策**: Plannerから始めて、タスク分解とロール割り当てを取得

### 「AIがワークフローに従っていない」
**解決策**: ワークフローファイルを明示的に参照:
```
.agent/workflows/backend-dev.mdのBackend-Devワークフローに従って、
これを実装してください: [タスク]
```

### 「ワークフローのステップをスキップしたい」
**解決策**: 明示的に指示:
```
Backend-Devとして、デプロイ制限チェックをスキップして、
これを実装してください: [タスク]
```

---

## 📊 成功指標

### Squadがうまく機能している時:
- ✅ タスクがマニフェスト要件に従って完了
- ✅ デプロイにビジュアル検証が含まれる
- ✅ 監査ログが常に実装される
- ✅ Windows/PowerShell構文エラーなし
- ✅ Base64エンコードが常に使用される
- ✅ デプロイ後にGitコミットが作成される

### Squadの調整が必要な時:
- ❌ マニフェスト要件が違反される
- ❌ デプロイが繰り返し失敗
- ❌ ワークフローが無視される
- ❌ ビジュアル検証が提供されない

---

## 🎓 高度な使い方

### カスタムワークフローの作成
`.agent/workflows/`に新しいワークフローファイルを追加:

```markdown
---
description: ワークフローの説明
---

# ワークフロー名

## ロール定義
[ロールを定義]

## ワークフローステップ
[ステップを定義]
```

### 既存ワークフローの拡張
ワークフローファイルを編集して追加:
- 新しいチェックリスト
- 新しいパターン
- 新しい例
- 学んだ教訓

---

## 📞 ヘルプの取得

### ワークフローを表示
```
Backend-Devワークフローを見せてください
```

### 全ワークフローをリスト
```
利用可能なワークフローは何ですか？
```

### ロールを理解する
```
Auditorロールとその使用タイミングを説明してください
```

---

## 🎉 準備完了！

CRM V9 Squadがセットアップされ、使用準備が整いました。

**次のステップ**:
1. PROJECT_MANIFEST.mdを確認
2. 作業するタスクを選択
3. 適切なロールを呼び出す
4. ワークフローに従う
5. 検証してデプロイ

**覚えておいてください**: Squadワークフローは、AIアシスタンスでエンタープライズグレードのソフトウェアを構築するためのガイドです。

Happy coding! 🚀
